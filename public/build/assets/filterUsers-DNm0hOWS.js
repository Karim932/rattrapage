$(document).ready(function(){$("button[data-role]").on("click",function(){const t=$(this).data("role");console.log("Button clicked, role: ",t),$.ajax({url:`/api/users/role?role=${t}`,success:function(o){u(o)},error:function(o,n,s){console.error("An error occurred during the AJAX request:",n,s),alert("Failed to load data: "+o.statusText)}})}),$("#cancel-role").on("click",function(){$.ajax({url:"/api/users/all",success:function(t){u(t)},error:function(t,o,n){console.error("An error occurred during the AJAX request:",o,n),alert("Failed to load data: "+t.statusText)}})});function u(t){const o=$("#users-table table tbody");o.empty(),t.length===0?o.append('<tr><td colspan="6" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">Aucun utilisateur trouvé</td></tr>'):t.forEach(n=>{const s=`/users/${n.id}`,c=`/users/${n.id}/edit`,a=`/users/${n.id}`,e=n.banned;o.append(`
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.id}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.firstname}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.lastname}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.email}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.role}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="${s}" class="text-indigo-600 hover:text-indigo-900">Voir</a>
                            <a href="${c}" class="text-indigo-600 hover:text-indigo-900 ml-4">Modifier</a>
                            <button
                                class="ban-button ${e?"text-green-600 hover:text-green-900":"text-red-600 hover:text-red-900"} ml-4"
                                data-id="${n.id}"
                                data-action="${e?"unban":"ban"}">
                                ${e?"Unban":"Ban"}
                            </button>
                            <form action="${a}" method="POST" class="inline" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                                <input type="hidden" name="_token" value="${$('meta[name="csrf-token"]').attr("content")}">
                                <input type="hidden" name="_method" value="DELETE">
                                <button type="submit" class="text-red-600 hover:text-red-900 ml-4">Supprimer</button>
                            </form>
                        </tr>
                `)})}let l=null;f();function d(t=null,o,n,s="/filter-users"){const c={role:t,sort:o,order:n};$.ajax({url:s,method:"GET",data:c,success:function(a){$("#users-table").html(a.html),$("#pagination-container").html(a.pagination);const e=$("#users-table table tbody tr td:first").text().trim();console.log("Content after load:",e),e===""||e==="Aucun utilisateur trouvé"?console.log('Table is empty or shows "Aucun utilisateur trouvé". No need to reload.'):(l=t,f(),m(o,n))},error:function(a,e,r){console.error("An error occurred:",e,r),console.log("Failed to load user table Non.")}})}function f(){$(".sort-link").off("click").on("click",function(){const t=$(this);let o=t.data("order");o=o==="asc"?"desc":"asc",t.data("order",o),t.attr("data-order",o),m(t.data("sort"),o),d(l,t.data("sort"),o)})}function m(t,o){$(".sort-link").each(function(){const n=$(this),s=n.data("sort");n.find(".sort-icon").text(s===t?o==="asc"?"▲":"▼":"↕")})}$("#cancel-role").on("click",function(){const t=$("#users-table table tbody tr td:first").text().trim();console.log("First TD Content:",t),!(t===""||t==="Aucun utilisateur trouvé")&&l!==null&&d()}),$(document).ready(function(){let t=null,o=null;function n(e,r){t=e,o=r,$("#modal-message").text(`Êtes-vous sûr de vouloir ${e} cet utilisateur ?`),$("#confirmation-modal").removeClass("hidden").fadeIn("fast")}$("body").on("click",".ban-button",function(e){e.preventDefault();const r=$(this).data("id"),i=$(this).data("action"),p=`/users/${i}/${r}`;n(i,p)}),$("body").on("submit","form.delete-user-form",function(e){e.preventDefault();const r=$(this).attr("action");n("supprimer",r)}),$("body").on("submit","form.refuse-user-form",function(e){e.preventDefault();const r=$(this).attr("action");n("refuser",r)}),$("body").on("submit","form.revoque-user-form",function(e){e.preventDefault();const r=$(this).attr("action");n("revoquer",r)}),$("body").on("submit","form.accept-user-form",function(e){e.preventDefault();const r=$(this).attr("action");n("accepter",r)}),window.openModal=function(){document.getElementById("responseModal").classList.remove("hidden")},window.closeModal=function(){document.getElementById("responseModal").classList.add("hidden")},$("#confirm-btn").on("click",function(){if(!o||!t){console.warn("URL or action not defined.");return}$.ajax({url:o,method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),_method:t==="supprimer"?"DELETE":"POST"},success:s,error:c})});function s(e){a(e.message),$("#confirmation-modal").fadeOut("fast",function(){$(this).addClass("hidden")}),setTimeout(function(){location.reload()},1e3)}function c(e){alert("Une erreur est survenue : "+e.statusText),console.error("An error occurred:",e.statusText)}function a(e){let r=$("#success-text"),i=$("#success-message");r.text(e||"La candidature a été mise à jour."),i.css("opacity","1").fadeIn("fast").delay(800).fadeOut("slow",function(){$(this).css("opacity","0")})}$("#cancel-btn").on("click",function(){$("#confirmation-modal").fadeOut("fast",function(){$(this).addClass("hidden")})})}),$("#search-users").on("keyup",function(){const t=$(this).val().toLowerCase();try{$("#users-table table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(t)>-1)})}catch(o){console.error("An error occurred while filtering the users:",o)}})});
