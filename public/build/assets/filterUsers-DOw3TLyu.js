$(document).ready(function(){$("button[data-role]").on("click",function(){const e=$(this).data("role");console.log("Button clicked, role: ",e),$.ajax({url:`/api/users/role?role=${e}`,success:function(o){u(o)},error:function(o,n,s){console.error("An error occurred during the AJAX request:",n,s),alert("Failed to load data: "+o.statusText)}})}),$("#cancel-role").on("click",function(){$.ajax({url:"/api/users/all",success:function(e){u(e)},error:function(e,o,n){console.error("An error occurred during the AJAX request:",o,n),alert("Failed to load data: "+e.statusText)}})});function u(e){const o=$("#users-table table tbody");o.empty(),e.length===0?o.append('<tr><td colspan="6" class="px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center">Aucun utilisateur trouvé</td></tr>'):e.forEach(n=>{const s=`/users/${n.id}`,c=`/users/${n.id}/edit`,a=`/users/${n.id}`,t=n.banned;o.append(`
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.firstname}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.lastname}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.email}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${n.role}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                            <a href="${s}" class="text-indigo-600 hover:text-indigo-900">Voir</a>
                            <a href="${c}" class="text-indigo-600 hover:text-indigo-900 ml-4">Modifier</a>
                            <button
                                class="ban-button ${t?"text-green-600 hover:text-green-900":"text-red-600 hover:text-red-900"} ml-4"
                                data-id="${n.id}"
                                data-action="${t?"unban":"ban"}">
                                ${t?"Unban":"Ban"}
                            </button>
                            <form action="${a}" method="POST" class="inline" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cet utilisateur ?');">
                                <input type="hidden" name="_token" value="${$('meta[name="csrf-token"]').attr("content")}">
                                <input type="hidden" name="_method" value="DELETE">
                                <button type="submit" class="text-red-600 hover:text-red-900 ml-4">Supprimer</button>
                            </form>
                        </tr>
                `)})}let l=null;f();function d(e=null,o,n,s="/filter-users"){const c={role:e,sort:o,order:n};$.ajax({url:s,method:"GET",data:c,success:function(a){$("#users-table").html(a.html),$("#pagination-container").html(a.pagination);const t=$("#users-table table tbody tr td:first").text().trim();t===""||t==="Aucun utilisateur trouvé"?console.log('Table is empty or shows "Aucun utilisateur trouvé". No need to reload.'):(l=e,f(),m(o,n))},error:function(a,t,r){console.error("An error occurred:",t,r),console.log("Failed to load user table Non.")}})}function f(){$(".sort-link").off("click").on("click",function(){const e=$(this);let o=e.data("order");o=o==="asc"?"desc":"asc",e.data("order",o),e.attr("data-order",o),m(e.data("sort"),o),d(l,e.data("sort"),o)})}function m(e,o){$(".sort-link").each(function(){const n=$(this),s=n.data("sort");n.find(".sort-icon").text(s===e?o==="asc"?"▲":"▼":"↕")})}$("#cancel-role").on("click",function(){const e=$("#users-table table tbody tr td:first").text().trim();console.log("First TD Content:",e),!(e===""||e==="Aucun utilisateur trouvé")&&l!==null&&d()}),$(document).ready(function(){let e=null,o=null;function n(t,r){e=t,o=r,$("#modal-message").text(`Êtes-vous sûr de vouloir ${t} cet utilisateur ?`),$("#confirmation-modal").removeClass("hidden").fadeIn("fast")}$("body").on("click",".ban-button",function(t){t.preventDefault();const r=$(this).data("id"),i=$(this).data("action"),h=`/users/${i}/${r}`;n(i,h)}),$("body").on("submit","form.delete-user-form",function(t){t.preventDefault();const r=$(this).attr("action");n("supprimer",r)}),$("body").on("submit","form.refuse-user-form",function(t){t.preventDefault();const r=$(this).attr("action");n("refuser",r)}),$("body").on("submit","form.revoque-user-form",function(t){t.preventDefault();const r=$(this).attr("action");n("revoquer",r)}),$("body").on("submit","form.accept-user-form",function(t){t.preventDefault();const r=$(this).attr("action");n("accepter",r)}),window.openModal=function(){document.getElementById("responseModal").classList.remove("hidden")},window.closeModal=function(){document.getElementById("responseModal").classList.add("hidden")},$("#confirm-btn").on("click",function(){if(!o||!e){console.warn("URL or action not defined.");return}$.ajax({url:o,method:"POST",data:{_token:$('meta[name="csrf-token"]').attr("content"),_method:e==="supprimer"?"DELETE":"POST"},success:s,error:c})});function s(t){a(t.message),$("#confirmation-modal").fadeOut("fast",function(){$(this).addClass("hidden")}),setTimeout(function(){t.redirectUrl&&t.redirectUrl.trim()!==""?window.location.href=t.redirectUrl:location.reload()},1e3)}function c(t){alert("Une erreur est survenue : "+t.statusText),console.error("An error occurred:",t.statusText)}function a(t){let r=$("#success-text"),i=$("#success-message");r.text(t||"La candidature a été mise à jour."),i.css("opacity","1").fadeIn("fast").delay(800).fadeOut("slow",function(){$(this).css("opacity","0")})}$("#cancel-btn").on("click",function(){$("#confirmation-modal").fadeOut("fast",function(){$(this).addClass("hidden")})})}),$("#search-users").on("keyup",function(){const e=$(this).val().toLowerCase();try{$("#users-table table tbody tr").filter(function(){$(this).toggle($(this).text().toLowerCase().indexOf(e)>-1)})}catch(o){console.error("An error occurred while filtering the users:",o)}})});
